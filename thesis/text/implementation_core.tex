\chapter{Implementacja trzonu narzędzia} \label{chap:implementation:core}

Zanim przystąpimy do prac nad generatorem aplikacji konkretnego typu, zajmijmy się samym procesem generacji artefaktów systemu, nazwanym tutaj ``trzonem'' narzędzia.


\subsection{Założenia dotyczące trzonu narzędzia}

O ile elastyczność generatora konkretnego typu aplikacji może być ograniczona, o~tyle trzon powinien być na tyle uniwersalny, by mógł być użyty w~celu wygenerowania wielu rodzajów plików tekstowych, w~tym kodu źródłowego w~dowolnym języku, skryptów DLL, skryptów powłoki, dokumentancji w~formacie HTML lub XML itd.
Pliki te powinny być generowane w~ten sam sposób (np. na podstawie szablonów napisanych w~jednym języki, takim jak xslt), tak aby programista korzystający z~narzędzia nie musiał poznawać całej gamy języków lub narzędzi używanych do tworzenia szablonów generacji.
Pożądaną funkcjonalnością jest możliwość łatwiej wymiany domyślnie użwanego rodzaju szablonów na inny, tak aby programista korzystający z~narzędzia mógł w~łatwy sposób użyć w~nim szablonów stworzonych w~języku, ktory zna.
Co więcej, trzon narzędzia nie pownien narzucać sposobu formatowania danych wejściowych (w~tym przypadku - opisu dziedziny aplikaji).

Dla wygody autora narzędzia zakłada się, że zarówno trzon narzędzia jak i~generator konkretnego typu aplikacji zostanie stworzony w~technolgii .NET Framework


\subsection{Organizacja plików źródłowych oczekiwana przez trzon}

Pierszą decyzją, którą należy podjąć w~trakcie implementacji, jest organizacja i~format plików źródłowych, na których pracował będzie trzon narzędzia.
Jak wspomniano wyżej, od trzonu oczekuje się jak największej elastyczności - dlatego trzon powinien wspierać wszystkie z~poniższych scenariuszy:

\subsection{Pojedynczy plik źródłowy}

W~tym scenariuszu całość dziedziny aplikacji (lub innych informacji o~systmie) zawarta jest pojedynczym pliku.
Przykładem zastosowania może pojedynczy skrypt SQL zawierający schemat bazy danych używanej przez aplkację.
Taki plik, oprócz swojego standardowego przeznaczenia, tj. konfigurowania bazy danych, pełniłby rolę źródła generatora \emph{Code First}.
Na jego podstawie generowane byłyby pliki zawierające defnijcje klas będących częścią implementacji modelu dziedziny w~aplikacji.


\subsection{Pojedynczy katalog z~wieloma plikami źródłowymi}

Kontynuując przykład, w~miarę upływu czasu wspomniany skrypt SQL może rozrosnąć się na tyle, że wystąpi potrzeba podzielenia go na kilka plików - np. według nazw schematów (ang. \emph{scheme})), w~których znajdują się poszczególne tabele.
Wszystkie te pliki w~dalszym ciągu byłyby źródłem dla generatora, a~wynikowe klasy mogłyby być umieszczone w~osobnych katalogach (podzielonych według nazw schematow, w~których znajdują się odpowiadające im tabele).

Przykład (dbo - schemat domyślny, pozostałe - schematy właściwe dla krajów, w~których działa system):

\dirtree{%
.1 database\_schema.
.2 dbo.sql.
.2 en.sql.
.2 pl.sql.
}

\subsection{Drzewo katalogów z~wielona plikami źródłowymi}

W~dłuższej perspektywie, w~opisywanym przykładzie może pojawić się potrzeba wprowadzenia podkatalogów dla poszczególnych schematów.
Pojedynczy podkatalog zawierałby osobne pliki zawierające definicje tabel, widoków i~procedur składowanych obecnych w~bazie danych.
Trzon narzędzia generującego powinien być w~stanie dotrzeć do wszystkich tych plików.

Przykład:

\dirtree{%
.1 database\_schema.
 .2 dbo.
  .3 tables.sql.
  .3 views.sql.
  .3 procedures.sql.
 .2 en.
  .3 tables.sql.
  .3 views.sql.
  .3 procedures.sql.
 .2 pl.
  .3 tables.sql.
  .3 views.sql.
  .3 procedures.sql.
}
